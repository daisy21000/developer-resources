{% extends "base.html" %}
{% block content %}
<div class="container">
    <div class="row text-center">
        <h1 class="mt-4">
            {% if query %}
            Search Results for "{{ query }}"
            {% else %}
            Search Resources
            {% endif %}
        </h1>
    </div>
    <div class="row">
        <div class="col">
        
            <p class="lead my-4 text-center">
                {% if resources|length == 0 %}
                {% if query %}
                No resources found for "{{ query }}".
                {% else %}
                Please enter a search query to find resources.
                {% endif %}
                {% else %}
                {{ resources|length }} resource{{ resources|length|pluralize }} found.
                {% endif %}
            </p>
        <form action="{% url 'search_resources' %}" method="get">
            <div class="input-group mb-4">
                <input type="text" class="form-control" name="q" placeholder="Search resources..." aria-label="Search resources" aria-describedby="button-search">
                <button class="btn secondary-button small-button" type="submit" id="button-search">Search</button>
            </div>
            <div class="accordion" id="searchFiltersAccordion">
                <div class="accordion-item">
                    <h2 class="accordion-header">
                    <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                        Search Filters &amp; Sort By
                    </button>
                    </h2>
                    <div id="collapseOne" class="accordion-collapse collapse show" data-bs-parent="#searchFiltersAccordion">
                        <div class="accordion-body">
                            <h3 class="h5">Search in:</h3>
                            <div class="input-group mb-4 flex-column flex-sm-row">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" name="in" type="checkbox" id="name_checkbox" value="name" checked>
                                    <label class="form-check-label" for="name_checkbox">Name</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" name="in" type="checkbox" id="desc_checkbox" value="description">
                                    <label class="form-check-label" for="desc_checkbox">Description</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" name="in" type="checkbox" id="keywords_checkbox" value="keywords">
                                    <label class="form-check-label" for="keywords_checkbox">Keywords</label>
                                </div>
                            </div>
                            <h3 class="h5">Sort by:</h3>
                            <select class="form-select" aria-label="Sort resources" name="sort_by">
                                <option value="alphabetical" selected>Alphabetical</option>
                                <option value="newest">Newest</option>
                                <option value="oldest">Oldest</option>
                                <option value="most_favorited">Most Favorited</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
            
        </form>
        <ul class="list-group my-4">
            {% for resource in resources %}
                <li class="list-group-item text-center text-sm-start d-sm-flex justify-content-between align-items-center">
                    <a href="#{{ resource.id }}Modal" class="list-group-item-action resource-link" data-bs-toggle="modal">
                        <h2 class="h4">{{ resource.name }}</h2>
                    </a>
                    {% if user.is_authenticated %}
                    {% if resource in favorite_resources %}
                    <a href="{% url 'favorite_resource' resource.id %}" class="ms-2 favorite-link"
                    aria-label="Remove {{ resource.name }} from favorites" title="Remove {{ resource.name }} from favorites"><i class="bi bi-bookmark-star-fill"></i>{% else %}
                    <a href="{% url 'favorite_resource' resource.id %}" class="ms-2 favorite-link"
                    aria-label="Add {{ resource.name }} to favorites" title="Add {{ resource.name }} to favorites"><i class="bi bi-bookmark-star"></i>{% endif %}</a>
                    {% if user.is_authenticated and user == resource.uploader %}
                    <a href="{% url 'edit_resource' resource.id %}" class="btn secondary-button small-button ms-2" role="button">Edit</a>
                    <a href="#{{ resource.id }}DeleteModal" class="btn delete-button small-button ms-2" data-bs-toggle="modal" role="button">Delete</a>
                    {% endif %}
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
        </div>
    </div>
</div>
{% for resource in resources %}
<!-- Modal Start -->
<div class="modal fade" id="{{ resource.id }}Modal" tabindex="-1" aria-labelledby="{{ resource.id }}ModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title fs-5" id="{{ resource.id }}ModalLabel">{{ resource.name }}</h3>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p><strong>Description: </strong>{{ resource.description }}</p>
        <p>
            <strong>URL: </strong>
            <a href="{{ resource.url }}">{{ resource.url }}</a>
        </p>
        <p><strong>Category: </strong>{{ resource.category.name }}</p>
        <p><strong>Uploaded by: </strong>{{ resource.uploader.username }}</p>
        <p><strong>Keywords: </strong>{{ resource.keywords.all|join:", " }}</p>
      </div>
      <div class="modal-footer justify-content-start justify-content-sm-end">
        {% if user.is_authenticated %}
        {% if resource in favorite_resources %}
        <a href="{% url 'favorite_resource' resource.id %}" class="btn delete-button">Remove from Favorites</a>
        {% else %}
        <a href="{% url 'favorite_resource' resource.id %}" class="btn secondary-button">Add to Favorites</a>
        {% endif %}
        {% endif %}
        <a href="{{ resource.url }}" type="button" class="btn primary-button">Visit Site</a>
      </div>
    </div>
  </div>
</div>
{% endfor %}
<!-- Modal End -->

{% for resource in resources %}
<!-- Delete Confirmation Modal Start -->
<div class="modal fade" id="{{ resource.id }}DeleteModal" tabindex="-1" aria-labelledby="{{ resource.id }}DeleteModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title fs-5" id="{{ resource.id }}DeleteModalLabel">Delete {{ resource.name }}</h3>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <p>Are you sure you want to delete this resource?</p>
      </div>
      <div class="modal-footer justify-content-start justify-content-sm-end">
        <a href="{% url 'delete_resource' resource.id %}" type="button" class="btn delete-button">Delete</a>
        <button type="button" class="btn secondary-button" data-bs-dismiss="modal">Cancel</button>
      </div>
    </div>
  </div>
</div>
{% endfor %}
<!-- Delete Confirmation Modal End -->
{% endblock %}